export class CorpsDEtat {
  public id: number;
  public name: string;
  public weigth: number;
}

export let corpsDEtats: CorpsDEtat[] = [
  { id: 108, name: "PEINTURE & PAPIER PEINT", weigth: 42244 },
  { id: 120, name: "PLOMBERIE-SANITAIRES-VMC", weigth: 23514 },
  { id: 93, name: "MENUISERIE INTERIEURE", weigth: 21716 },
  { id: 92, name: "MENUISERIE EXTERIEURE", weigth: 16881 },
  { id: 140, name: "REVETEMENTS DE SOLS DURS", weigth: 13638 },
  { id: 110, name: "PEINTURE INTERIEURE", weigth: 13093 },
  { id: 62, name: "ELECTRICITE", weigth: 12443 },
  { id: 84, name: "GROS OEUVRE", weigth: 11982 },
  { id: 32, name: "CLOISONS - DOUBLAGES", weigth: 9170 },
  { id: 69, name: "ETANCHEITE", weigth: 5671 },
  { id: 141, name: "REVETEMENTS DE SOLS SOUPLES", weigth: 5439 },
  { id: 22, name: "CARRELAGE", weigth: 4893 },
  { id: 119, name: "PLOMBERIE", weigth: 4857 },
  { id: 137, name: "RAVALEMENT", weigth: 4629 },
  { id: 72, name: "FACADE", weigth: 4291 },
  { id: 64, name: "ENTREPRISE GENERALE", weigth: 3641 },
  { id: 145, name: "SERRURERIE", weigth: 3220 },
  { id: 45, name: "COURANT FORT", weigth: 2897 },
  { id: 101, name: "NETTOYAGE (NON PRORATA)", weigth: 2838 },
  { id: 47, name: "CUISINES EQUIPEES", weigth: 2332 },
  { id: 94, name: "METALLERIE", weigth: 2121 },
  { id: 75, name: "FERMETURES ET VOLETS", weigth: 1890 },
  { id: 105, name: "PARQUET", weigth: 1842 },
  { id: 68, name: "ESPACES VERTS", weigth: 1524 },
  { id: 46, name: "COUVERTURE", weigth: 1179 },
  { id: 89, name: "MAITRE D'OEUVRE EXECUTION", weigth: 920 },
  { id: 24, name: "CHARPENTE - COUVERTURE", weigth: 813 },
  { id: 67, name: "ESCALIER BOIS", weigth: 735 },
  { id: 123, name: "PORTES DE GARAGES", weigth: 567 },
  { id: 118, name: "PLATRERIE", weigth: 491 },
  { id: 48, name: "CUISINISTE", weigth: 485 },
  { id: 7, name: "ASCENSEURS", weigth: 396 },
  { id: 159, name: "V.R.D.", weigth: 361 },
  { id: 144, name: "SAV", weigth: 336 },
  { id: 109, name: "PEINTURE EXTERIEURE", weigth: 282 },
  { id: 33, name: "CLOTURES PORTILLONS", weigth: 272 },
  { id: 151, name: "TERASS.- ASSAIN. - VOIRIE - TR", weigth: 227 },
  { id: 10, name: "AUTRE REVETEMENT DE SOLS DUR", weigth: 212 },
  { id: 25, name: "CHARPENTE BOIS", weigth: 202 },
  { id: 31, name: "CLOISONS", weigth: 191 },
  { id: 17, name: "BETONS & MAÇONNERIE", weigth: 181 },
  { id: 103, name: "OUVRAGES PARTICULIERS", weigth: 166 },
  { id: 116, name: "PLACO", weigth: 137 },
  { id: 79, name: "GARDES CORPS", weigth: 133 },
  { id: 111, name: "PIERRES DE FACADES", weigth: 133 },
  { id: 107, name: "PAYSAGISTE (VRD)", weigth: 114 },
  { id: 142, name: "SALLES DE BAINS", weigth: 108 },
  { id: 153, name: "TERRASSEMENT", weigth: 95 },
  { id: 14, name: "AUTRES METALLERIES", weigth: 87 },
  { id: 162, name: "VOIRIE", weigth: 84 },
  { id: 90, name: "MAITRE D'OEUVRE EXECUTION (MI)", weigth: 81 },
  { id: 63, name: "ELECTRICITE BT-EP", weigth: 66 },
  { id: 104, name: "PAPIERS PEINTS", weigth: 58 },
  { id: 23, name: "CHAPES", weigth: 56 },
  { id: 30, name: "CLIMATISATION", weigth: 46 },
  { id: 139, name: "REVETEMENT", weigth: 45 },
  { id: 88, name: "ISOLATION SOUFFLÉE", weigth: 43 },
  { id: 122, name: "PORTE ENTREE", weigth: 40 },
  { id: 27, name: "CHAUFFAGE ELECTRIQUE", weigth: 38 },
  { id: 66, name: "EQUIPEMENT SPECIFIQUE", weigth: 36 },
  { id: 161, name: "VOIERIE", weigth: 34 },
  { id: 9, name: "ASSAINISSEMENT", weigth: 32 },
  { id: 44, name: "COURANT FAIBLE", weigth: 32 },
  { id: 157, name: "TRAVAUX DIVERS", weigth: 32 },
  { id: 13, name: "AUTRES HONORAIRES VRD", weigth: 31 },
  { id: 124, name: "PRECADRES", weigth: 31 },
  { id: 106, name: "PAYSAGISTE (CONSTRUCTION)", weigth: 29 },
  { id: 5, name: "ARCHITECTE", weigth: 28 },
  { id: 73, name: "FAUX PLAFONDS", weigth: 28 },
  { id: 11, name: "AUTRES HONORAIRES", weigth: 27 },
  { id: 99, name: "MULTIRISQUES & RC PROMOT", weigth: 26 },
  { id: 158, name: "TRAVAUX DIVERS", weigth: 25 },
  { id: 28, name: "CHAUFFAGE GAZ", weigth: 24 },
  { id: 152, name: "TERRASSE", weigth: 23 },
  { id: 15, name: "BET VRD", weigth: 21 },
  { id: 113, name: "PISCINES", weigth: 20 },
  { id: 98, name: "MOQUETTE", weigth: 17 },
  { id: 77, name: "FONDATIONS SPECIALES", weigth: 14 },
  { id: 29, name: "CHEMINEE", weigth: 13 },
  { id: 96, name: "MOBILIER URBAIN (MURET)", weigth: 13 },
  { id: 36, name: "CONCESSIONNAIRES F.TELECOM", weigth: 12 },
  { id: 127, name: "PREPARATION - TERRASSEMENT", weigth: 12 },
  { id: 19, name: "BUREAU DE CONTROLE", weigth: 11 },
  { id: 26, name: "CHARPENTE METALLIQUE", weigth: 10 },
  { id: 52, name: "DECORATION ET HALL", weigth: 8 },
  { id: 82, name: "GEOTECHNICIEN (VRD)", weigth: 6 },
  { id: 121, name: "PORTE DE SERVICE", weigth: 6 },
  { id: 146, name: "SIGNALISATION - BOITES AUX LET", weigth: 6 },
  { id: 16, name: "BETON ARME", weigth: 4 },
  { id: 115, name: "PLACARDS", weigth: 4 },
  { id: 150, name: "TELEDISTRIBUTION", weigth: 3 },
  { id: 34, name: "CONCESSIONNAIRES EAU", weigth: 3 },
  { id: 160, name: "VMC", weigth: 3 },
  { id: 81, name: "GEOMETRES", weigth: 2 },
  { id: 4, name: "ALARME", weigth: 2 },
  { id: 59, name: "ECLAIRAGISTE", weigth: 2 },
  { id: 154, name: "TOUS RISQUES CHANTIER", weigth: 2 },
  { id: 1, name: "ACCES PROVISOIRE (CRAMIF)", weigth: 2 },
  { id: 59, name: "ECLAIRAGISTE", weigth: 2 },
  { id: 81, name: "GEOMETRES", weigth: 2 },
  { id: 86, name: "HYGIENE ET SECURITE", weigth: 2 },
  { id: 134, name: "RACCORDEMENT EGOUTS", weigth: 2 },
  { id: 49, name: "DALLAGE", weigth: 1 },
  { id: 133, name: "RACCORDEMENT EDF", weigth: 1 },
  { id: 18, name: "BUREAU D'ETUDES", weigth: 1 },
  { id: 102, name: "OUVRAGE EXT:BASSIN EP - SEPARA", weigth: 1 },
  { id: 134, name: "RACCORDEMENT EGOUTS", weigth: 1 },
  { id: 143, name: "SANITAIRES", weigth: 1 },
  { id: 12, name: "AUTRES HONORAIRES CONSTRUCTION", weigth: 1 },
  { id: 53, name: "DEMOLITION", weigth: 1 },
  { id: 135, name: "RACCORDEMENT FRANCE TELECOM", weigth: 1 },
  { id: 39, name: "CONSO DIVERS", weigth: 1 },
  { id: 58, name: "ECHAFFAUDAGE (PROTECTION COLL)", weigth: 1 },
  { id: 3, name: "ADAPTATION AU SOL", weigth: 1 },
  { id: 20, name: "CANTONNEMENT", weigth: 1 },
  { id: 38, name: "CONDUIT ET SOUCHE CHEMINEE", weigth: 1 },
  { id: 39, name: "CONSO DIVERS", weigth: 1 },
  { id: 51, name: "DECORATEUR", weigth: 1 },
  { id: 53, name: "DEMOLITION", weigth: 1 },
  { id: 60, name: "EDF TELECOM", weigth: 1 },
  { id: 78, name: "FUMISTERIE", weigth: 1 },
  { id: 91, name: "MARBRE", weigth: 1 },
  { id: 102, name: "OUVRAGE EXT:BASSIN EP - SEPARA", weigth: 1 },
  { id: 129, name: "PROTECTION INCENDIE", weigth: 1 },
  { id: 132, name: "RACCORDEMENT EAU", weigth: 1 },
  { id: 133, name: "RACCORDEMENT EDF", weigth: 1 }
];

export class Entreprise {
  public id: number;
  public name: string;
}

export let entreprises: Entreprise[] = [
  { id: 1, name: "Entreprise de peinture" },
  { id: 2, name: "Entreprise de carrelage" },
  { id: 3, name: "Entreprise ACME" },
  { id: 4, name: "Entreprise Electricite" }
];

export class LigneCarnetAdresse {
  public id: number;
  public corpsDEtat: CorpsDEtat;
  public entreprise: Entreprise;
}

export let carnetAdresse: LigneCarnetAdresse[] = [
  { id: 1, corpsDEtat: corpsDEtats[0], entreprise: entreprises[0] },
  { id: 2, corpsDEtat: corpsDEtats[5], entreprise: entreprises[0] },
  { id: 3, corpsDEtat: corpsDEtats[0], entreprise: entreprises[2] },
  { id: 4, corpsDEtat: corpsDEtats[5], entreprise: entreprises[2] },
  { id: 5, corpsDEtat: corpsDEtats[6], entreprise: entreprises[3] },
  { id: 6, corpsDEtat: corpsDEtats[6], entreprise: entreprises[2] },
  { id: 7, corpsDEtat: corpsDEtats[11], entreprise: entreprises[1] }
];

export class CarnetDAdresseProvider {
  limiterAuCarnet: boolean = true;

  constructor() {}

  onlyUnique(value, index, self) {
    return self.indexOf(value) === index;
  }

  filterCorpsDEtat(text: string) {
    let matchingCorpsDEtat: CorpsDEtat[];
    if (this.limiterAuCarnet) {
      matchingCorpsDEtat = carnetAdresse
        .map(x => x.corpsDEtat)
        .filter(this.onlyUnique)
        .filter((a, b, c) => this.matchesCorpsDEtat(a, b, c, text));
    } else {
      matchingCorpsDEtat = corpsDEtats.filter((a, b, c) =>
        this.matchesCorpsDEtat(a, b, c, text)
      );
    }
    matchingCorpsDEtat.sort(this.sortWeight);
    matchingCorpsDEtat = matchingCorpsDEtat.slice(0, 19);
    matchingCorpsDEtat.sort(this.sortName);
    console.log("Matching corps d'etat done");
    return matchingCorpsDEtat;
  }

  private matchesCorpsDEtat(element, index, array, text) {
    let result: number;
    result = element.name.indexOf(text);
    return result > -1;
  }

  private sortWeight(obj1: CorpsDEtat, obj2: CorpsDEtat) {
    let result: number = 1;
    if (obj1.weigth > obj2.weigth) {
      result = -1;
    } else if (obj1.weigth == obj2.weigth) {
      result = 0;
    }
    return result;
  }

  private sortName(obj1: CorpsDEtat, obj2: CorpsDEtat) {
    let result: number = 1;
    if (obj1.name < obj2.name) {
      result = -1;
    } else if (obj1.name == obj2.name) {
      result = 0;
    }
    return result;
  }

  filterEntreprise(corpsDEtat: CorpsDEtat) {
    let matchingEntreprises: Entreprise[] = [];
    for (var currLigne of carnetAdresse) {
      if (currLigne.corpsDEtat.id == corpsDEtat.id) {
        matchingEntreprises.push(currLigne.entreprise);
      }
    }
    return matchingEntreprises;
  }
}
